<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>insertVideo</title>
	<script type="text/javascript" src="./scripts/jquery-3.3.1.js"></script>
	<script type="text/javascript" src="./scripts/bootstrap.js"></script>
	<style type="text/css" src="./css/bootstrap.css"></style>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
</head>
<body>
	<div id="videoPlayer">
		<video id="demo" src="./media/animals.mp4" width="1080px" height="500px"></video>
		<button id="play" type="button"><span class="glyphicon glyphicon-play-circle" aria-hidden="true"></span></button>
		<div id="videoControls"> 
            <div id="progressWrap">  
                <div id="playProgress">  
                    <span id="showProgress"></span> 
                </div>
            </div>
            <div>
                <button id="playBtn" class="glyphicon glyphicon-play" aria-hidden="true" title="Play"></button>
            </div> 
            <div>
              	<button id="fullScreenBtn" class="glyphicon glyphicon-fullscreen" aria-hidden="true" title="FullScreen Toggle"></button>
            </div>
            <div>
              	<button id="soundControl" class="glyphicon glyphicon-volume-up" aria-hidden="true"></button>
              	<div id="audioWrap"><div id="soundWrap"></div></div>
          	</div>
        </div> 
	</div>
	<script>
	(function(window, document){
        // 获取要操作的元素
        var video = document.getElementById("demo");
        var videoControls = document.getElementById("videoControls");
        var videoContainer = document.getElementById("videoPlayer");
        var controls = document.getElementById("video_controls");
        var play_center = document.getElementById("play");
        var playBtn = document.getElementById("playBtn");
        var fullScreenBtn = document.getElementById("fullScreenBtn");
        var soundControlBtn = document.getElementById("soundControl");
        var progressWrap = document.getElementById("progressWrap");
        var playProgress = document.getElementById("playProgress");
        var fullScreenFlag = false;
        var progressFlag;

        // 创建我们的操作对象，我们的所有操作都在这个对象上。
        var videoPlayer = {
            init: function(){
                var that = this;
                video.removeAttribute("controls");
                bindEvent(video, "loadeddata", videoPlayer.initControls);
                videoPlayer.operateControls();
            },
            initControls: function(){
                videoPlayer.showHideControls();
            },
            showHideControls: function(){
                bindEvent(video, "mouseover", showControls);
                bindEvent(videoControls, "mouseover", showControls);
                bindEvent(video, "mouseout", hideControls);
                bindEvent(videoControls, "mouseout", hideControls);
            },
            operateControls: function(){
                bindEvent(playBtn, "click", play);
                bindEvent(video, "click", play);
                bindEvent(play_center, "click", play);
                bindEvent(play_center, "click", hideButton);
                bindEvent(fullScreenBtn, "click", fullScreen);
                bindEvent(soundControlBtn, "click", mute);
                bindEvent(audioWrap, "click", audioControl);
                bindEvent(progressWrap, "mousedown", videoSeek);
            }
        }

        videoPlayer.init();

        // 原生的JavaScript事件绑定函数
        function bindEvent(ele, eventName, func){
            if(window.addEventListener){
                ele.addEventListener(eventName, func);
            }
            else{
                ele.attachEvent('on' + eventName, func);
            }
        }
        // 显示video的控制面板
        function showControls(){
            videoControls.style.opacity = 1;
        }
        // 隐藏video的控制面板
        function hideControls(){
            videoControls.style.opacity = 0;
        }
        // 控制video的播放
        function play(){
            if ( video.paused || video.ended ){              
                if ( video.ended ){ 
                    video.currentTime = 0;
                    } 
                video.play();
                hideButton();
                //playBtn.innerHTML = "暂停"; 
                progressFlag = setInterval(getProgress, 60);
            } 
            else{ 
                video.pause(); 
                showButton();
                //playBtn.innerHTML = "播放";
                clearInterval(progressFlag);
            } 
        }
        // 控制视频音量
        function mute() {
        	var vol = video.volume;
        	if(vol) {
        		video.volume = 0;
        	}
        	else {
        		video.volume = 1;
        	}
        }
        // 控制video是否全屏，尚未实现
        function fullScreen(){
            var docElm = document.documentElement;
  			if (docElm.requestFullscreen) {
    			docElm.requestFullscreen();
  			} else if (docElm.mozRequestFullScreen) {
    			docElm.mozRequestFullScreen();
  			} else if (docElm.webkitRequestFullScreen) {
    			docElm.webkitRequestFullScreen();
  			} else if (docElm.msRequestFullscreen) {
    			docElm.msRequestFullscreen();
  			}
        }
        function exitFullscreen() {
  			if (document.exitFullscreen) {
    			document.exitFullscreen();
  			} else if (document.mozCancelFullScreen) {
    			document.mozCancelFullScreen();
  			} else if (document.webkitCancelFullScreen) {
    			document.webkitCancelFullScreen();
  			} else if (document.msExitFullscreen) {
    			document.msExitFullscreen();
  			}
		}
        // video的播放条
        function getProgress(){
            var percent = video.currentTime / video.duration;
            var totalTime = transformTime(video.duration);
            var currentTime = transformTime(video.currentTime);
            playProgress.style.width = percent * (progressWrap.offsetWidth) - 2 + "px";
            showProgress.innerHTML = currentTime + '/' + totalTime;
        }
        // 鼠标在播放条上点击时进行捕获并进行处理
        function videoSeek(e){
            if(video.paused || video.ended){
                play();
                enhanceVideoSeek(e);
            }
            else{
                enhanceVideoSeek(e);
            }
        }
        function enhanceVideoSeek(e){
            clearInterval(progressFlag);
            var length = e.pageX - progressWrap.offsetLeft - demo.offsetLeft - 100;
            var percent = length / progressWrap.offsetWidth;
            playProgress.style.width = percent * (progressWrap.offsetWidth) + "px";
            video.currentTime = percent * video.duration;
            progressFlag = setInterval(getProgress, 60);
        }
        function audioControl(e) {
        	var length = e.pageX - audioWrap.offsetLeft - demo.offsetLeft - 100;
        	var percent = length / audioWrap.offsetWidth;
            soundWrap.style.width = percent * (audioWrap.offsetWidth) + "px";
            video.volume = percent * 1.0;
        }
        function transformTime(num) {
        	var totalSecond = (parseInt(num) % 60).toString();
            if(totalSecond.length < 2) {
            	totalSecond = '0' + totalSecond;
            }
            var totalMinute = (parseInt(num / 60)).toString();
            if(totalMinute.length < 2) {
            	totalMinute = '0' + totalMinute;
            }
            var totalTime = totalMinute + ":" + totalSecond;
            return totalTime;
        }
        function hideButton(){
			var btn = document.getElementById("play");
			btn.style.display = "none";
		}
		function showButton(){
			var btn = document.getElementById("play");
			btn.style.display = "block";	
		}
    }(this, document))
	</script>
</body>
</html>

<!--
    2018.3.23
1. 这次大概了解了一下怎么用html插入视频以及插入的视频有哪些属性和方法
2. 自己写了一个播放控制条，可以控制视频的播放和暂停、播放进度、音量和全屏，但是全屏目前只是网页进入全屏模式，视频的大小和位置没有变化。控制条可以隐藏。
3. 视频现在有三种播放和暂停的方式，一是点击视频中央的播放键，二是点击左下角的播放键，三是点击视频画面
4. 用了bootstrap的图标组件
5. 点击视频进度条任意位置可以调整播放进度，点击音量条任意位置可以调整音量大小，直接点击音量图标可以实现静音

2018.3.30

进展

1. 把HTML和CSS、JS分开成不同文件了
2. 加入了适配手机界面的代码，调了很久样式都没有调好，明后天试一下bootstrap再上传一遍吧
3. 全屏没有实现……下周主要解决这个问题
-->